# 服务器日志查看与管理指南

本文档详细介绍如何在服务器上查看、管理和分析 AI Studio Proxy API 的日志。

## 目录

- [日志系统概述](#日志系统概述)
- [在服务器上查看日志](#在服务器上查看日志)
- [日志级别控制](#日志级别控制)
- [日志管理](#日志管理)
- [常用命令速查](#常用命令速查)
- [远程访问](#远程访问)
- [故障排查](#故障排查)

## 日志系统概述

### 日志文件位置

项目包含两个主要的日志文件，都保存在 `logs/` 目录下：

| 文件 | 用途 | 内容 |
|------|------|------|
| `logs/app.log` | 主服务器日志 | FastAPI 服务器详细运行日志，包括请求处理、错误信息、系统状态等 |
| `logs/launch_app.log` | 启动器日志 | 启动和协调过程日志，包含 Camoufox 浏览器进程的输出 |

### 日志保存机制

日志文件会自动持久化保存，具有以下特性：

- **自动轮转**：单个日志文件最大 5MB
- **备份保留**：保留最近 5 个备份文件（`app.log.1` ~ `app.log.5`）
- **编码格式**：UTF-8
- **格式化**：包含时间戳、日志级别、模块名、函数名、行号和消息内容

**日志格式示例**：
```
2025-10-22 15:21:34,567 - INFO - [AIStudioProxyServer:process_request:123] - [abc123] 收到 /v1/chat/completions 请求
```

### 日志系统组件

项目包含三个日志输出渠道：

1. **文件日志**：完整详细，永久保存在 `logs/app.log`
2. **WebSocket 日志**：实时推送到 Web UI，INFO 及以上级别
3. **控制台日志**：输出到终端（调试模式）或重定向到日志系统（无头模式）

## 在服务器上查看日志

### 方法 1：实时查看（tail）

**最常用的方式**，适合监控正在运行的服务。

#### 基础用法

```bash
# 实时跟踪主服务器日志（最常用）
tail -f logs/app.log

# 实时跟踪启动器日志
tail -f logs/launch_app.log

# 同时监控两个日志文件
tail -f logs/app.log logs/launch_app.log
```

#### 显示行数

```bash
# 显示最后 50 行并持续跟踪
tail -n 50 -f logs/app.log

# 只显示最后 100 行（不跟踪）
tail -n 100 logs/app.log

# 从指定行开始显示
tail -n +100 logs/app.log
```

#### 高级用法

```bash
# 彩色输出（需要安装 ccze）
tail -f logs/app.log | ccze -A

# 只显示包含 "ERROR" 的行
tail -f logs/app.log | grep --color=always -i error

# 排除某些内容
tail -f logs/app.log | grep -v "健康检查"

# 高亮显示特定内容
tail -f logs/app.log | grep --color=always -E "ERROR|WARNING|CRITICAL"
```

### 方法 2：查看完整日志

#### 使用 less（推荐）

```bash
# 可翻页查看，支持搜索
less logs/app.log

# less 内部命令：
# - 空格键：下一页
# - b：上一页
# - /搜索词：向下搜索
# - ?搜索词：向上搜索
# - n：下一个匹配
# - N：上一个匹配
# - G：跳到文件末尾
# - g：跳到文件开头
# - q：退出

# 带行号显示
less -N logs/app.log

# 不换行显示长行
less -S logs/app.log
```

#### 使用 cat

```bash
# 输出完整日志
cat logs/app.log

# 带行号输出
cat -n logs/app.log

# 显示不可见字符
cat -A logs/app.log
```

#### 使用 head

```bash
# 显示前 20 行
head -n 20 logs/app.log

# 显示前 50 行
head -n 50 logs/app.log
```

### 方法 3：搜索特定内容（grep）

#### 基础搜索

```bash
# 搜索错误信息（不区分大小写）
grep -i error logs/app.log

# 搜索特定请求 ID
grep "abc123" logs/app.log

# 搜索多个关键词（任一匹配）
grep -E "error|warning|critical" logs/app.log

# 搜索多个关键词（全部匹配）
grep error logs/app.log | grep "req_id"
```

#### 显示上下文

```bash
# 显示匹配行及其前后 3 行
grep -C 3 -i error logs/app.log

# 显示匹配行及其前 5 行
grep -B 5 -i error logs/app.log

# 显示匹配行及其后 5 行
grep -A 5 -i error logs/app.log
```

#### 高级搜索

```bash
# 显示行号
grep -n -i error logs/app.log

# 只显示匹配的文件名（多文件搜索）
grep -l error logs/*.log

# 统计匹配次数
grep -c error logs/app.log

# 显示不匹配的行
grep -v "健康检查" logs/app.log

# 递归搜索（包括备份文件）
grep -r error logs/

# 只显示匹配的部分
grep -o "req_id: [a-z0-9]*" logs/app.log
```

#### 时间范围搜索

```bash
# 搜索今天的日志
grep "$(date +%Y-%m-%d)" logs/app.log

# 搜索特定日期
grep "2025-10-22" logs/app.log

# 搜索特定时间段
grep "2025-10-22 15:" logs/app.log

# 搜索昨天的日志
grep "$(date -d yesterday +%Y-%m-%d)" logs/app.log
```

### 方法 4：通过 Web UI 查看

Web UI 提供实时日志查看功能：

**访问方式**：
```
http://服务器IP:2048
```

**特点**：
- 右侧边栏自动显示实时日志
- 只显示 INFO 及以上级别
- 通过 WebSocket 实时推送（`ws://服务器IP:2048/ws/logs`）
- 包含日志级别、时间戳和消息内容
- 提供"清除日志"按钮清空显示

**适用场景**：
- 快速查看服务状态
- 不需要 SSH 访问权限
- 实时监控请求处理
- 向非技术人员展示

### 方法 5：通过 systemd 查看（如果使用）

如果你使用 systemd 管理服务：

```bash
# 实时查看服务日志
sudo journalctl -u aistudio-proxy -f

# 查看最近 100 条日志
sudo journalctl -u aistudio-proxy -n 100

# 查看今天的日志
sudo journalctl -u aistudio-proxy --since today

# 查看特定时间段
sudo journalctl -u aistudio-proxy --since "2025-10-22 10:00" --until "2025-10-22 15:00"

# 查看特定优先级的日志（错误及以上）
sudo journalctl -u aistudio-proxy -p err

# 反向查看（最新的在前）
sudo journalctl -u aistudio-proxy -r

# 导出日志到文件
sudo journalctl -u aistudio-proxy > /tmp/service_logs.txt
```

## 日志级别控制

### 可用的日志级别

| 级别 | 数值 | 说明 | 适用场景 |
|------|------|------|----------|
| DEBUG | 10 | 最详细的诊断信息 | 开发调试、故障排查 |
| INFO | 20 | 一般信息性消息 | 日常运行（默认） |
| WARNING | 30 | 警告消息，潜在问题 | 生产环境监控 |
| ERROR | 40 | 错误消息，功能异常 | 错误分析 |
| CRITICAL | 50 | 严重错误，系统级问题 | 严重故障 |

### 环境变量配置

#### SERVER_LOG_LEVEL

控制主服务器日志记录器的级别。

```bash
# 临时设置（当前会话）
export SERVER_LOG_LEVEL=DEBUG

# 永久设置（添加到 .bashrc 或 .bash_profile）
echo 'export SERVER_LOG_LEVEL=INFO' >> ~/.bashrc
source ~/.bashrc

# 在 .env 文件中设置（推荐）
echo 'SERVER_LOG_LEVEL=INFO' >> .env
```

#### DEBUG_LOGS_ENABLED

控制特定功能的详细调试日志点。

```bash
# 启用调试日志
export DEBUG_LOGS_ENABLED=true

# 禁用调试日志
export DEBUG_LOGS_ENABLED=false
```

#### TRACE_LOGS_ENABLED

控制更深层次的跟踪日志（通常不需要）。

```bash
# 启用跟踪日志
export TRACE_LOGS_ENABLED=true

# 禁用跟踪日志
export TRACE_LOGS_ENABLED=false
```

### 不同场景的推荐配置

#### 场景 1：日常运行（推荐）

适合生产环境日常使用，平衡信息量和性能。

**配置**：
```bash
export SERVER_LOG_LEVEL=INFO
export DEBUG_LOGS_ENABLED=false
export TRACE_LOGS_ENABLED=false

python launch_camoufox.py --headless
```

**或在 .env 文件中**：
```env
SERVER_LOG_LEVEL=INFO
DEBUG_LOGS_ENABLED=false
TRACE_LOGS_ENABLED=false
```

**日志特点**：
- 记录重要操作和状态变化
- 不记录详细的函数调用
- 性能影响最小
- 文件增长速度适中

#### 场景 2：调试模式（详细日志）

适合开发测试、故障排查。

**配置**：
```bash
export SERVER_LOG_LEVEL=DEBUG
export DEBUG_LOGS_ENABLED=true
export TRACE_LOGS_ENABLED=false

python launch_camoufox.py --debug
```

**或在 .env 文件中**：
```env
SERVER_LOG_LEVEL=DEBUG
DEBUG_LOGS_ENABLED=true
TRACE_LOGS_ENABLED=false
```

**日志特点**：
- 记录详细的函数调用和参数
- 包含变量值和执行流程
- 适合深度调试
- 文件增长较快

#### 场景 3：深度跟踪（最详细）

适合复杂问题的深度分析。

**配置**：
```bash
export SERVER_LOG_LEVEL=DEBUG
export DEBUG_LOGS_ENABLED=true
export TRACE_LOGS_ENABLED=true

python launch_camoufox.py --debug
```

**或在 .env 文件中**：
```env
SERVER_LOG_LEVEL=DEBUG
DEBUG_LOGS_ENABLED=true
TRACE_LOGS_ENABLED=true
```

**日志特点**：
- 最详细的诊断信息
- 包含所有内部状态
- 性能影响较大
- 文件增长很快

#### 场景 4：生产环境（最少日志）

适合稳定的生产环境，只记录警告和错误。

**配置**：
```bash
export SERVER_LOG_LEVEL=WARNING
export DEBUG_LOGS_ENABLED=false
export TRACE_LOGS_ENABLED=false

python launch_camoufox.py --headless
```

**或在 .env 文件中**：
```env
SERVER_LOG_LEVEL=WARNING
DEBUG_LOGS_ENABLED=false
TRACE_LOGS_ENABLED=false
```

**日志特点**：
- 只记录警告、错误和严重错误
- 性能影响最小
- 文件增长最慢
- 适合稳定运行的系统

### 动态调整日志级别

如果服务正在运行，需要重启才能应用新的日志配置：

```bash
# 1. 停止服务
pkill -f launch_camoufox.py

# 2. 设置新的日志级别
export SERVER_LOG_LEVEL=DEBUG

# 3. 重新启动
python launch_camoufox.py --headless
```

## 日志管理

### 查看日志文件大小

```bash
# 查看 logs 目录总大小
du -sh logs/

# 查看各个日志文件大小
du -h logs/*

# 详细列出文件大小
ls -lh logs/

# 按大小排序
ls -lhS logs/
```

**输出示例**：
```
-rw-r--r-- 1 user user 4.2M Oct 22 15:21 app.log
-rw-r--r-- 1 user user 5.0M Oct 21 10:30 app.log.1
-rw-r--r-- 1 user user 5.0M Oct 20 18:45 app.log.2
-rw-r--r-- 1 user user 7.8K Oct 22 15:21 launch_app.log
```

### 清理旧日志

#### 手动清理

```bash
# 清空当前日志文件（保留文件）
> logs/app.log
> logs/launch_app.log

# 删除备份日志文件
rm logs/app.log.*

# 删除所有日志文件
rm -f logs/*.log*

# 删除 7 天前的日志
find logs/ -name "*.log*" -mtime +7 -delete

# 删除大于 10MB 的日志文件
find logs/ -name "*.log*" -size +10M -delete
```

#### 安全清理脚本

创建 `scripts/clean_logs.sh`：

```bash
#!/bin/bash
# 日志清理脚本

LOG_DIR="logs"
BACKUP_DIR="logs_backup"
DATE=$(date +%Y%m%d_%H%M%S)

# 创建备份目录
mkdir -p "$BACKUP_DIR"

# 备份当前日志
echo "正在备份日志..."
tar -czf "$BACKUP_DIR/logs_$DATE.tar.gz" "$LOG_DIR"/*.log

# 清理旧的备份文件（保留最近 5 个）
echo "清理旧备份..."
ls -t "$BACKUP_DIR"/logs_*.tar.gz | tail -n +6 | xargs rm -f

# 清空当前日志
echo "清空日志文件..."
> "$LOG_DIR/app.log"
> "$LOG_DIR/launch_app.log"

# 删除所有备份日志文件
echo "删除备份日志文件..."
rm -f "$LOG_DIR"/*.log.*

echo "日志清理完成！"
echo "备份文件：$BACKUP_DIR/logs_$DATE.tar.gz"
```

使用：
```bash
chmod +x scripts/clean_logs.sh
./scripts/clean_logs.sh
```

### 日志轮转

#### 内置轮转

项目已配置自动日志轮转：
- 单个文件最大：5MB
- 备份数量：5 个
- 命名规则：`app.log`, `app.log.1`, `app.log.2`, ..., `app.log.5`

#### 使用 logrotate（推荐生产环境）

**创建配置文件** `/etc/logrotate.d/aistudio-proxy`：

```bash
/path/to/AIstudioProxyAPI/logs/*.log {
    # 每天轮转
    daily

    # 保留 7 天的日志
    rotate 7

    # 压缩旧日志
    compress

    # 延迟压缩（当前备份不压缩）
    delaycompress

    # 日志文件不存在时不报错
    missingok

    # 空日志文件不轮转
    notifempty

    # 轮转后创建新文件（权限 644，所有者 username）
    create 0644 username username

    # 轮转后执行的脚本
    postrotate
        # 可选：重启服务以使用新日志文件
        # systemctl reload aistudio-proxy
    endscript
}
```

**手动测试轮转**：
```bash
sudo logrotate -f /etc/logrotate.d/aistudio-proxy
```

**查看轮转状态**：
```bash
sudo cat /var/lib/logrotate/status | grep aistudio
```

#### 按大小轮转配置

```bash
/path/to/AIstudioProxyAPI/logs/*.log {
    # 当文件大于 10MB 时轮转
    size 10M

    # 保留 10 个备份
    rotate 10

    compress
    missingok
    notifempty
    create 0644 username username
}
```

#### 按周轮转配置

```bash
/path/to/AIstudioProxyAPI/logs/*.log {
    # 每周轮转
    weekly

    # 保留 4 周的日志
    rotate 4

    compress
    missingok
    notifempty
    create 0644 username username
}
```

### 日志归档

#### 手动归档

```bash
# 创建归档目录
mkdir -p logs_archive

# 归档今天之前的所有日志
tar -czf logs_archive/logs_$(date +%Y%m%d).tar.gz logs/*.log.*

# 删除已归档的文件
rm logs/*.log.*

# 归档并压缩当前日志
gzip -c logs/app.log > logs_archive/app_$(date +%Y%m%d_%H%M%S).log.gz
> logs/app.log
```

#### 自动归档脚本

创建 `scripts/archive_logs.sh`：

```bash
#!/bin/bash
# 日志归档脚本

LOG_DIR="logs"
ARCHIVE_DIR="logs_archive"
DATE=$(date +%Y%m%d)

# 创建归档目录
mkdir -p "$ARCHIVE_DIR"

# 归档所有备份日志
if ls "$LOG_DIR"/*.log.* 1> /dev/null 2>&1; then
    echo "归档备份日志..."
    tar -czf "$ARCHIVE_DIR/backup_logs_$DATE.tar.gz" "$LOG_DIR"/*.log.*
    rm -f "$LOG_DIR"/*.log.*
    echo "备份日志已归档"
fi

# 清理超过 30 天的归档
find "$ARCHIVE_DIR" -name "*.tar.gz" -mtime +30 -delete
echo "已清理 30 天前的归档"
```

#### 定期归档（crontab）

```bash
# 编辑 crontab
crontab -e

# 添加以下行（每周日凌晨 2 点执行）
0 2 * * 0 /path/to/AIstudioProxyAPI/scripts/archive_logs.sh

# 或每天凌晨 3 点执行
0 3 * * * /path/to/AIstudioProxyAPI/scripts/archive_logs.sh
```

## 常用命令速查

### 实时监控

```bash
# 实时监控主日志
tail -f logs/app.log

# 只显示错误和警告
tail -f logs/app.log | grep -E "ERROR|WARNING"

# 彩色高亮显示
tail -f logs/app.log | grep --color=always -E "ERROR|WARNING|INFO"

# 监控多个文件
tail -f logs/*.log
```

### 错误查看

```bash
# 查看所有错误
grep -i error logs/app.log

# 查看最近 20 个错误
grep -i error logs/app.log | tail -n 20

# 查看错误及上下文
grep -C 5 -i error logs/app.log

# 统计错误数量
grep -c -i error logs/app.log

# 查看不同类型的错误
grep -i "404\|500\|502\|503" logs/app.log
```

### 时间过滤

```bash
# 今天的日志
grep "$(date +%Y-%m-%d)" logs/app.log

# 最近一小时
grep "$(date +%Y-%m-%d\ %H):" logs/app.log

# 特定时间段（15:00-16:00）
grep "2025-10-22 15:" logs/app.log

# 昨天的日志
grep "$(date -d yesterday +%Y-%m-%d)" logs/app.log
```

### 统计分析

```bash
# 统计每种日志级别的数量
grep -o -E "INFO|WARNING|ERROR|CRITICAL|DEBUG" logs/app.log | sort | uniq -c

# 统计每小时的请求数
grep "收到.*请求" logs/app.log | cut -d' ' -f1-2 | cut -d':' -f1-2 | uniq -c

# 查看最频繁的错误
grep ERROR logs/app.log | sort | uniq -c | sort -rn | head -n 10

# 统计不同 HTTP 状态码
grep -oE "status_code=[0-9]+" logs/app.log | sort | uniq -c

# 查看处理最慢的请求
grep "处理完成" logs/app.log | sort -t'耗时' -k2 -rn | head -n 10
```

### 请求追踪

```bash
# 查看特定请求的完整日志
grep "\[abc123\]" logs/app.log

# 查看所有请求 ID
grep -oE "\[[a-z0-9]{7}\]" logs/app.log | sort -u

# 查看失败的请求
grep "请求.*失败\|错误" logs/app.log

# 统计请求数量
grep "收到.*请求" logs/app.log | wc -l
```

### 导出和备份

```bash
# 导出今天的错误日志
grep "$(date +%Y-%m-%d)" logs/app.log | grep ERROR > today_errors.log

# 导出特定时间段的日志
grep "2025-10-22 15:" logs/app.log > hour_15.log

# 创建压缩备份
tar -czf logs_backup_$(date +%Y%m%d).tar.gz logs/

# 只备份备份文件
tar -czf old_logs_$(date +%Y%m%d).tar.gz logs/*.log.*
```

## 远程访问

### SSH 连接方式

#### 基本连接

```bash
# 使用密码连接
ssh username@8.217.6.233

# 使用 SSH 密钥连接
ssh -i ~/.ssh/id_rsa username@8.217.6.233

# 指定端口
ssh -p 22 username@8.217.6.233
```

#### SSH 配置文件

编辑 `~/.ssh/config`：

```
Host aistudio
    HostName 8.217.6.233
    User username
    Port 22
    IdentityFile ~/.ssh/id_rsa
    ServerAliveInterval 60
```

使用：
```bash
ssh aistudio
```

### 远程查看日志

```bash
# 连接并直接查看日志
ssh username@8.217.6.233 "tail -f /path/to/AIstudioProxyAPI/logs/app.log"

# 查看最近的错误
ssh username@8.217.6.233 "grep -i error /path/to/AIstudioProxyAPI/logs/app.log | tail -n 20"

# 下载日志文件到本地
scp username@8.217.6.233:/path/to/AIstudioProxyAPI/logs/app.log ./local_app.log

# 使用 rsync 同步日志目录
rsync -avz username@8.217.6.233:/path/to/AIstudioProxyAPI/logs/ ./local_logs/
```

### 使用 tmux 或 screen

推荐使用 tmux 或 screen 保持会话：

```bash
# 安装 tmux
sudo apt install tmux  # Ubuntu/Debian
sudo yum install tmux  # CentOS/RHEL

# 创建新会话
tmux new -s logs

# 在会话中查看日志
tail -f logs/app.log

# 分离会话（Ctrl+B 然后按 D）

# 重新连接
tmux attach -t logs

# 列出所有会话
tmux ls
```

## 故障排查

### 日志不显示

**问题**：日志文件为空或没有新内容。

**排查步骤**：

1. 检查日志文件是否存在
```bash
ls -la logs/
```

2. 检查文件权限
```bash
ls -la logs/app.log
# 应该有写权限（-rw-r--r--）
```

3. 检查磁盘空间
```bash
df -h
```

4. 检查服务是否运行
```bash
ps aux | grep launch_camoufox
```

5. 检查环境变量
```bash
echo $SERVER_LOG_LEVEL
echo $DEBUG_LOGS_ENABLED
```

**解决方案**：

```bash
# 重新创建日志目录
mkdir -p logs
chmod 755 logs

# 删除旧的日志文件并重启
rm -f logs/app.log
python launch_camoufox.py --headless
```

### 日志过多，文件增长太快

**问题**：日志文件快速增长，占用大量磁盘空间。

**原因**：
- 日志级别设置为 DEBUG
- 启用了 DEBUG_LOGS_ENABLED 或 TRACE_LOGS_ENABLED
- 高频请求产生大量日志

**解决方案**：

1. 降低日志级别
```bash
export SERVER_LOG_LEVEL=INFO
# 或
export SERVER_LOG_LEVEL=WARNING
```

2. 禁用调试日志
```bash
export DEBUG_LOGS_ENABLED=false
export TRACE_LOGS_ENABLED=false
```

3. 配置更激进的日志轮转
```bash
# 在 /etc/logrotate.d/aistudio-proxy 中
size 5M
rotate 3
```

4. 立即清理
```bash
./scripts/clean_logs.sh
```

### 日志缺失重要信息

**问题**：日志中找不到需要的调试信息。

**原因**：
- 日志级别设置过高（WARNING 或 ERROR）
- DEBUG_LOGS_ENABLED 未启用

**解决方案**：

1. 提高日志详细程度
```bash
export SERVER_LOG_LEVEL=DEBUG
export DEBUG_LOGS_ENABLED=true
```

2. 重启服务
```bash
pkill -f launch_camoufox
python launch_camoufox.py --headless
```

3. 检查日志文件而不是终端
```bash
tail -f logs/app.log
```

### WebSocket 日志不显示

**问题**：Web UI 中看不到日志。

**排查步骤**：

1. 检查浏览器控制台是否有 WebSocket 连接错误
2. 检查服务器防火墙是否允许 WebSocket 连接
3. 检查服务器日志中是否有 WebSocket 相关错误

**解决方案**：

```bash
# 检查 WebSocket 连接
curl -i -N -H "Connection: Upgrade" -H "Upgrade: websocket" \
  http://8.217.6.233:2048/ws/logs

# 允许 WebSocket 端口（如果使用防火墙）
sudo ufw allow 2048/tcp

# 重启服务
pkill -f launch_camoufox
python launch_camoufox.py --headless
```

### 特定请求找不到日志

**问题**：无法找到某个特定请求的日志。

**排查方法**：

```bash
# 1. 搜索请求 ID
grep "req_id" logs/app.log | grep "关键词"

# 2. 搜索时间戳
grep "2025-10-22 15:21" logs/app.log

# 3. 搜索客户端 IP
grep "来自.*IP地址" logs/app.log

# 4. 搜索模型名称
grep "gemini" logs/app.log

# 5. 检查备份文件
grep "关键词" logs/app.log.*
```

## 性能考虑

### 日志级别对性能的影响

| 日志级别 | CPU 开销 | I/O 开销 | 文件大小增长 | 推荐场景 |
|---------|----------|----------|--------------|----------|
| DEBUG | 高 | 高 | 很快 | 开发调试 |
| INFO | 中 | 中 | 适中 | 日常运行 |
| WARNING | 低 | 低 | 慢 | 生产环境 |
| ERROR | 很低 | 很低 | 很慢 | 稳定系统 |

### 优化建议

1. **生产环境使用 WARNING 级别**
```bash
export SERVER_LOG_LEVEL=WARNING
```

2. **禁用不必要的调试日志**
```bash
export DEBUG_LOGS_ENABLED=false
export TRACE_LOGS_ENABLED=false
```

3. **配置合理的日志轮转**
```bash
# logrotate 配置
size 5M
rotate 5
compress
```

4. **定期清理旧日志**
```bash
# crontab
0 2 * * 0 /path/to/scripts/clean_logs.sh
```

5. **使用日志级别过滤**
```python
# 只记录重要信息
logger.info("重要操作")  # 会记录
logger.debug("详细调试") # 在 INFO 级别下不记录
```

## 最佳实践

### 日常运行

```bash
# 1. 使用 INFO 级别
export SERVER_LOG_LEVEL=INFO

# 2. 启动服务
python launch_camoufox.py --headless

# 3. 定期查看日志
tail -f logs/app.log | grep -E "ERROR|WARNING"

# 4. 每周检查日志大小
du -sh logs/
```

### 问题调试

```bash
# 1. 临时提高日志级别
export SERVER_LOG_LEVEL=DEBUG
export DEBUG_LOGS_ENABLED=true

# 2. 重启服务
pkill -f launch_camoufox
python launch_camoufox.py --debug

# 3. 实时监控日志
tail -f logs/app.log

# 4. 问题解决后恢复正常级别
export SERVER_LOG_LEVEL=INFO
export DEBUG_LOGS_ENABLED=false
```

### 生产环境部署

```bash
# 1. 使用最小日志级别
export SERVER_LOG_LEVEL=WARNING

# 2. 配置 logrotate
sudo cp logrotate_config /etc/logrotate.d/aistudio-proxy

# 3. 设置自动清理
crontab -e
# 添加: 0 2 * * 0 /path/to/scripts/clean_logs.sh

# 4. 监控磁盘空间
df -h | grep logs

# 5. 定期归档
0 3 1 * * /path/to/scripts/archive_logs.sh
```

## 相关文档

- [日志控制指南](docs/logging-control.md) - 详细的日志配置说明
- [故障排除指南](docs/troubleshooting.md) - 常见问题解决方案
- [API 使用指南](docs/api-usage.md) - API 调用和参数说明

## 总结

本指南涵盖了 AI Studio Proxy API 日志系统的全部内容：

1. 日志保存在 `logs/app.log` 和 `logs/launch_app.log`
2. 支持多种查看方式（tail, grep, less, Web UI）
3. 可通过环境变量控制日志级别和详细程度
4. 内置日志轮转，支持 logrotate 配置
5. 提供丰富的命令行工具进行日志分析
6. 支持远程 SSH 访问和查看

通过合理配置和使用日志系统，可以有效地监控服务运行状态、快速定位问题并进行性能优化。
